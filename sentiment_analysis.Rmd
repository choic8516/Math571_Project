---
title: "Math571_project"
output: html_document
---

# Converting headlines into scores (using SentimentAnalysis package)
```{r}
library(xlsx)
library(tidyverse)
library(SentimentAnalysis)
library(splitstackshape)
year<-1989

headlines<-read.csv(paste0("data/nyt_headlines_",year,".csv"),stringsAsFactors = F)
num.days<-length(table(headlines$pub_date))
headlines<-stratified(headlines,"pub_date",25)
#sort(table(headlines$pub_date))
#I added a restriction to the analyeSentiment function so it only calculates
#with the GI dictionary, wich makes it much more efficient
iter<-0
convert_to_score <- function(df) {
        sentiment <- analyzeSentiment(df,
                              rules=list("SentimentGI"=list(ruleSentiment, 
                                                            loadDictionaryGI())))
        assign("iter",iter+1, env=.GlobalEnv)
        if (iter%%10==0) print(iter)
        return(sentiment$SentimentGI)
}

# this following operation takes about 20 seconds for my laptop. I feel like it takes little too long. 
data_sentiment <- lapply(headlines$main, convert_to_score)
data_sentiment<-cbind(headlines,unlist(data_sentiment))[,c(5,2,6)]
write.csv(data_sentiment,paste0("data/scores_",year,".csv"))

days<-unique(data_sentiment$pub_date)
heads.25<-data.frame()
scores.25<-data.frame()
for (day in days){
        data.frame.sent<-data.frame(day,t(data_sentiment$main[data_sentiment$pub_date==day]))
        heads.25<-rbind(heads.25,data.frame.sent)
        data.frame.sent<-data.frame(day,t(data_sentiment$V2[data_sentiment$pub_date==day]))
        scores.25<-rbind(scores.25,data.frame.sent)
        
}        

```


